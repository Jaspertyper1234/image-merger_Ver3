# 图片合成工具

这是一个基于 TypeScript 和 Vite 构建的网页应用程序，用于将多张图片合成为一张图片。

## 功能

- 上传多张图片
- 选择合成类型（2合1，3合1，4合1，6合1，9合1）
- 设置图片间隔
- 设置合成间隔
- 预览合成结果
- 下载合成后的图片（ZIP格式，包含所有合成图片）
- 导出合成图片到Excel
- 导出合成图片到PDF
- 清除已上传和合成的图片

## 安装

1. 克隆仓库：
   ```bash
   git clone [仓库URL]
   ```

2. 进入项目目录：
   ```bash
   cd [项目文件夹名]
   ```

3. 安装依赖：
   ```bash
   npm install
   ```

## 使用说明

1. 打开 `index.html` 文件在浏览器中运行应用程序。
2. 点击"选择图片"按钮选择要合成的图片，然后点击"上传图片"按钮。
3. 选择合成类型、设置图片间隔和合成间隔。
4. 点击"合成图片"按钮生成合成图片。
   - 如果图片数量不足，系统会提示您上传更多图片。
5. 在预览区域查看合成结果。点击预览图可以查看原始大小的图片。
6. 使用"下载图片"按钮将所有合成图片保存为ZIP文件，或使用"导出Excel"和"导出PDF"按钮导出相应格式的文件。
   - 导出的Excel文件中包含每个合成图片的链接，可以复制链接到浏览器中查看图片。

## 技术栈

- TypeScript
- Vite
- HTML5 Canvas
- Web Workers
- JSZip
- SheetJS (xlsx)
- jsPDF

## 贡献

欢迎提出问题或提交拉取请求。对于重大更改，请先开issue讨论您想要更改的内容。

## 许可证

[MIT](https://choosealicense.com/licenses/mit/)

## 调试过程记录

在开发过程中，我们遇到了一些问题并成功解决了它们。以下是主要的调试步骤：

1. **问题**：合成图片时出现重复图片。
   **解决方法**：修改了 `compositeImages` 函数，确保每次合成时使用正确的图片索引。

2. **问题**：合成的图片数量不正确。
   **解决方法**：
   - 使用 `Math.floor` 替代 `Math.ceil` 来计算 `totalSteps`，避免多生成一组不完整的图片。
   - 在 `for` 循环中使用 `Math.floor(i / (type * interval))` 来准确计算当前处理的组数。
   - 在处理不完整组的 `else` 分支中添加 `break` 语句，确保在遇到不完整的组时停止合成。

3. **问题**：需要固定生成合成图片的数量，避免出现重复图片。
   **解决方法**：修改 `compositeImages` 函数，使其只生成固定数量的合成图片。具体做法是：
   - 计算 `totalCompositedImages` 为上传图片数量除以合成类型（向下取整）。
   - 修改循环逻辑，确保生成的合成图片数量等于 `totalCompositedImages`。
   - 每次合成都使用固定数量（等于合成类型）的图片。

4. **问题**：Excel导出功能只显示标题，没有图片链接。
   **解决方法**：修改了 `exportToExcel` 函数，改进了Excel文件的结构和样式。
   - 为每个合成图片创建三行数据：标题、说明和图片链接。
   - 调整了列宽和行高，优化了显示效果。
   - 设置了单元格样式，提高了可读性。
   - 直接将图片链接（dataURL）写入到单元格中，确保链接可见。

5. **问题**：Excel导出功能只显示第一张合成图片。
   **解决方法**：修改了 `exportToExcel` 函数，确保所有合成图片都被正确导出到Excel文件中。
   - 使用 `forEach` 循环遍历所有合成图片。
   - 为每张图片创建单独的工作表。
   - 在每个工作表中添加图片标题、说明和数据URL链接。
   - 调整了单元格的宽度和高度，以及设置了适当的样式。

注意：此问题的解决方法正在验证中。

## 待解决的问题

1. **Excel导出功能只显示一张合成图片**：目前，导出到Excel时只有第一张合成图片被正确处理。需要修改 `exportToExcel` 函数，确保所有合成图片都被正确导出到Excel文件中。

## 未来改进

- 解决Excel导出功能只显示一张图片的问题
- 添加更多的合成布局选项
- 实现图片裁剪功能
- 添加图片滤镜效果
- 优化大量图片处理时的性能